def sum_of_squares_distinct_counts(nums):
    total_sum = 0
    for i in range(len(nums)):
        count = {}
        for j in range(i, len(nums)):
            count[nums[j]] = count.get(nums[j], 0) + 1
            total_sum += sum(val ** 2 for val in count.values())
    return total_sum

# Example
nums = [1, 2, 1]
result = sum_of_squares_distinct_counts(nums)
print(result)  # Output: 15
